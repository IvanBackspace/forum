document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("style");function a(e){var t=e.parentNode.querySelector("input");0<t.value.length?e.style.display="block":e.style.display="none"}e.type="text/css",e.innerHTML=`
    .custom-error {
        border: 1px solid red !important;
    }
`,document.head.appendChild(e),document.querySelectorAll(".input-clear").forEach(t=>{t.parentNode.querySelector("input").addEventListener("input",()=>a(t)),a(t),t.addEventListener("click",()=>{var e;(e=t).parentNode.querySelector("input").value="",a(e)})}),[].forEach.call(document.querySelectorAll("input[type=tel]"),function(e){let u;function t(e){e.keyCode&&(u=e.keyCode),this.selectionStart<3&&e.preventDefault();let t="+7 (___) ___-__-__",a=0,r=t.replace(/\D/g,""),n=this.value.replace(/\D/g,""),l=t.replace(/[_\d]/g,function(e){return a<n.length?n.charAt(a++)||r.charAt(a):e});-1!=(a=l.indexOf("_"))&&(a<5&&(a=3),l=l.slice(0,a));var i=t.substr(0,this.value.length).replace(/_+/g,function(e){return"\\d{1,"+e.length+"}"}).replace(/[+()]/g,"\\$&");(!(i=new RegExp("^"+i+"$")).test(this.value)||this.value.length<5||47<u&&u<58)&&(this.value=l),"blur"==e.type&&this.value.length<5&&(this.value="")}e.addEventListener("input",t,!1),e.addEventListener("focus",t,!1),e.addEventListener("blur",t,!1),e.addEventListener("keydown",t,!1)});e=document.querySelectorAll('button[type="submit"]');function o(e,t,a){let r=e.closest(".popup");e.innerHTML=t,a.split(" ").forEach(e=>{r.classList.add(e)})}function c(e){e.classList.add("custom-error")}function d(e){e.classList.remove("custom-error")}e.forEach(e=>{let t=e.parentNode;var a,r=document.createElement("div");r.innerHTML=`<input name="trafficSource" type="hidden" value="">
            <input name="istochnik" type="hidden" value="">
            <input name="clientID" type="hidden" value="${a=document.cookie.match("(?:^|;)\\s*_ym_uid=([^;]*)"),!!a&&decodeURIComponent(a[1])}">`,t.appendChild(r),"undefined"!=typeof sbjs&&(sbjs.init(r),t.querySelector("input[name=trafficSource]").value=sbjs.get.current.typ,t.querySelector("input[name=istochnik]").value=sbjs.get.current.src),setTimeout(function(){},(a=5e3,r=7e3,Math.ceil(Math.random()*(r-a))+a-1)),e.addEventListener("click",async function(e){e.preventDefault();var e=this.closest("form"),t=e.dataset.modalOpen,a={success:e.dataset.modalOk,error:e.dataset.modalErr};let r={};e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{e.hasAttribute("required")&&(r[e.name]={type:e.type,value:e.value})});a={success:document.querySelector(a.success),error:document.querySelector(a.error)};if((e=>{let t=!0;for(var a in e){var r=e[a];switch(r.type){case"tel":r.value.replace(/\D/g,"").length<11&&(t=!1);break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(r.value)||r.value.trim().length<=2)&&(t=!1);break;default:t=!1}}var n;return t&&(n=document.querySelector(".popup-change-ok"))&&n.classList.add("active","open"),t})(r)){var n=this,l=e,i=n.innerText;n.innerHTML="Отправление",n.disabled=!0;try{var u=await fetch("/netcat_template/ajax/request.php",{method:"POST",body:new FormData(l)}),s=await u.text();o(u.ok?a.success:a.error,s,t)}catch(e){o(a.error,e.message,t)}finally{((e,t)=>{e.innerText=t,e.disabled=!1})(n,i)}}else e.querySelectorAll('input[type="tel"], textarea, input[type="text"]').forEach(e=>{switch(e.type){case"tel":e.value.replace(/\D/g,"").length<11&&(c(e),e.setCustomValidity("Введите верный номер телефона"),e.reportValidity(),setTimeout(()=>{e.setCustomValidity(""),d(e)},2e3));break;case"textarea":case"text":(!/[а-яА-ЯёЁ]/.test(e.value)||e.value.trim().length<=2)&&(c(e),e.setCustomValidity("Текст должен содержать русские буквы"),e.reportValidity(),setTimeout(()=>{e.setCustomValidity(""),d(e)},2e3));break;default:e.setCustomValidity("Поле не заполнено"),e.reportValidity(),c(e),setTimeout(()=>{e.setCustomValidity(""),d(e)},1e3)}})}),document.querySelectorAll("input[name='urlMessage'], input[name='title_url_message']").forEach(e=>{var t=""+window.location.origin+window.location.pathname;e.value="urlMessage"===e.name?t:document.title})})});
//# sourceMappingURL=request.js.map
